{
 "align_labels_right": 0,
 "creation": "2021-10-20 13:34:50.445620",
 "css": "@font-face {\n  font-family: lato;\n  src: url('/assets/energielenker/fonts/lato-v20-latin-regular.woff2');\n}\n\n.blue-white:nth-child(odd) {\n  background-color: rgb(186, 210, 226) !important;\n}\n\n.item-table thead tr:nth-child(even) {\n    background-color: unset !important;\n    border-bottom: 3px solid rgb(186, 210, 226) !important;\n    font-weight: bold;\n}\n\n#no-bgc-table tbody tr:nth-child(odd) {\n    background-color: transparent !important;\n    padding: 0 !important;\n}\n\n#no-bgc-table tbody td {\n    padding: 0 !important;\n}\n\n.print-format {\n    font-size: 10pt;\n    margin-left: 2mm;\n    margin-right: 0mm;\n}\n\n#main_content {\n    padding-left: 55px;\n    padding-right: 55px;\n}\n\nbody {\n    padding: 0 0 5mm !important;\n    font-family: lato !important;\n}\n\n.avoidBreak { \n    page-break-inside:avoid !important;\n}",
 "custom_format": 1,
 "default_print_language": "de",
 "disable_smart_shrinking": 1,
 "disabled": 0,
 "doc_type": "Sales Invoice",
 "docstatus": 0,
 "doctype": "Print Format",
 "font": "Default",
 "html": "<!--Teil und Schlussrechnung-->\n\n<!-- Ref Data -->\n{% set customer = frappe.get_doc(\"Customer\", doc.customer) %}\n{% if doc.contact_person_two %}\n{% set contact = frappe.get_doc(\"Contact\", doc.contact_person_two) %}\n{% endif %}\n{% if doc.po_no %}\n    {% set kundenreferenz = doc.po_no %}\n{% else %}\n    {% set kundenreferenz = '' %}\n{% endif %}\n{% if doc.project %}\n    {% set project = frappe.get_doc(\"Project\", doc.project) %}\n    {% set project_manager = frappe.get_doc(\"User\", project.project_manager) %}\n    {% if project.commercial_contact %}\n        {% set commercial_contact = frappe.get_doc(\"User\", project.commercial_contact) %}\n    {% endif %}\n{% endif %}\n{% if doc.ansprechpartner %}\n    {% set user_ansprechpartner = frappe.get_doc(\"User\", doc.ansprechpartner) %}\n{% endif %}\n{% if doc.k_ansprechperson %}\n    {% set user_ansprechperson = frappe.get_doc(\"User\", doc.k_ansprechperson) %}\n{% endif %}\n{% if doc.customer_address %}\n    {% set customer_address = frappe.get_doc(\"Address\", doc.customer_address) %}\n{% endif %}\n{% if doc.shipping_address_name %}\n    {% set shipping_address = frappe.get_doc(\"Address\", doc.shipping_address_name) %}\n{% endif %}\n{% if doc.payment_terms_template %}\n    {% set payment_terms = frappe.get_doc(\"Payment Terms Template\", doc.payment_terms_template) %}\n{% endif %}\n{% if doc.items[0].sales_order %}\n{% set sales_order = frappe.get_doc(\"Sales Order\", doc.items[0].sales_order) %}\n{% else %}\n{% set sales_order = False %}\n{% endif %}\n{% if doc.items[0].sales_order %}\n    {% set so_kunde_ref = frappe.get_doc(\"Sales Order\", doc.items[0].sales_order).referenz_kunde %}\n    {% set so_number = doc.items[0].sales_order %}\n{% endif %}\n\n{% set cur_icon = [] %}\n{% if doc.currency == 'EUR' %}\n{% set cur_icon = '&euro;' %}\n{% else %}\n{% set cur_icon = doc.currency %}\n{% endif %}\n\n<!-- header -->\n<div id=\"header-html\" class=\"hidden-pdf\" style=\"width: 100%;\">\n    <span><img alt=\"Energielenker Solutions\" src=\"/assets/energielenker/images/Briefkopf_randlos_bogen.jpg\" style=\"height: 90px !important; margin-top: 20px; margin-left: 10px;\"></span><span><img alt=\"Energielenker Solutions\" src=\"/assets/energielenker/images/Briefkopf_randlos_logo.jpg\" style=\"height: 95px !important; margin-left: 360px;\"></span>\n</div> \n\n<!-- Adressbereich (Kunde, Ansprech.part., Komm.kont.) -->\n<table style=\"width: 100%;\">\n    <tr>\n        <td rowspan=\"3\" style=\"width: 58.7%;\">\n            <div style=\"padding-left: 55px !important; padding-top: 65px !important;\">\n            <!--Lieferschein: LS Adresse-->\n            <span><img alt=\"Energielenker Solutions\" src=\"/assets/energielenker/images/klima_zukunft_randlos.jpg\" style=\"width: 35% !important; \"></span><br>\n            <span style=\"font-size: 6.5pt; color: rgb(129, 173, 202);\">energielenker solutions GmbH | Hafenweg 15 | 48155 M\u00fcnster<br></span>\n            <!--Kein Lieferschein, RG Adresse -->\n            \n                {% if not customer_address.address_line2 %}\n                    {% if doc.doctype == 'Quotation' %} {{ doc.party_name }}<br>\n                    {% else %}\n                        {{ doc.customer }}<br>\n                    {% endif %}\n                    {% if customer_address.adresszusatz %} {{  customer_address.adresszusatz }}<br>{% endif %}\n                    {% if doc.contact_person_two %}\n                        {{ contact.last_name }} {% if contact.middle_name %}{{ contact.middle_name }}{% endif %}\n                        {{ contact.first_name }}<br>\n                    {% endif %}\n                    {% if customer_address.address_line1 %} {{  customer_address.address_line1 }}{% endif %}\n                    {% if customer_address.hausnummer %} {{  customer_address.hausnummer }}<br> {% else %} <br> {% endif %}\n                    {% if customer_address.plz %} {{  customer_address.plz }}{% endif %}\n                    {% if customer_address.city %} {{  customer_address.city }}<br>{% endif %}\n                    {% if customer_address.country != \"Germany\" %}{{ _(customer_address.country) }}{% endif %}\n                {% else %}\n                    {{ customer_address.address_line2 }}<br><!--Firma-->\n                    {% if customer_address.adresszusatz %} {{  customer_address.adresszusatz }}<br>{% endif %}\n                    {% if doc.contact_person_two %}\n                        {{ contact.last_name }} {% if contact.middle_name %}{{ contact.middle_name }}{% endif %}\n                        {{ contact.first_name }}<br>\n                    {% endif %}\n                    {{ customer_address.address_line1 }} {{ customer_address.hausnummer }}<br>\n                    {{ customer_address.plz }} {{ customer_address.city }}\n                    {% if customer_address.country != \"Germany\" %}<br>{{ _(customer_address.country) }}{% endif %}\n                {% endif %}\n            \n            </div>\n        </td>\n        <td style=\"font-size: 8pt !important;\">\n        {% if not doc.clear_ap %}\n            {% if doc.ansprechpartner %}\n                Ihre Kundenbetreuung:<br>\n                {{ user_ansprechpartner.full_name }}<br>\n                Tel. {{ user_ansprechpartner.phone or '-' }}<br>\n                E-Mail: {{ user_ansprechpartner.email or '-' }}\n            {% else %}\n                {% if doc.project %}\n                    {% if project_manager %}\n                        Ihre Kundenbetreuung:<br>\n                        {{ project_manager.full_name }}<br>\n                        Tel. {{ project_manager.phone or '-' }}<br>\n                        E-Mail: {{ project_manager.email or '-' }}\n                    {% endif %}\n                {% endif %}\n            {% endif %}\n        {% endif %}\n        </td>\n    </tr>\n    <tr>\n        <td style=\"font-size: 8pt !important;\">\n                {% if doc.k_ansprechperson %}\n                Ihre kaufm\u00e4nnische Betreuung:<br>\n                    {{ user_ansprechperson.full_name }}<br>\n                    Tel. {{ user_ansprechperson.phone or '-' }}<br>\n                    E-Mail: {{ user_ansprechperson.email or '-' }}\n                {% else %}\n                    {% if commercial_contact %}\n                        Ihre kaufm\u00e4nnische Betreuung:<br>\n                        {{ commercial_contact.full_name }}<br>\n                        Tel. {{ commercial_contact.phone or '-' }}<br>\n                        E-Mail: {{ commercial_contact.email or '-' }}\n                    {% endif %}\n                {% endif %}\n        </td>\n    </tr>\n</table>\n<p><br></p>\n<div id=\"main_content\">\n    <!-- Titel und Referenzdaten -->\n    <table style=\"width: 100%;\">\n        <tr>\n            <td style=\"width: 60%; font-size: 13pt;\"><b>                                \n                {% if doc.billing_type == 'Teilrechnung' %}\n                    {{ _(\"Teilrechnung\") }}\n                {% elif doc.billing_type == 'Schlussrechnung' %}\n                    {{ _(\"Schlussrechnung\") }}\n                {% else %}\n                    <span style=\"color: red;\">{{ _(\"Bitte verwenden Sie das korrekte Druckformat f\u00fcr Rechnungen\") }}<br></span>\n                {% endif %}</b></td>\n            <td style=\"width: 40%; font-size: 10pt; \">M\u00fcnster, {{ doc.get_formatted('posting_date') }}</td>\n        </tr>\n    </table>\n\n    <!-- Items & Referenzdaten Table -->\n    <table class=\"item-table\" style=\"width: 100%;\">\n        <thead>\n            <tr>\n                <td colspan=\"5\">\n                <!-- Referenzdaten Table -->\n                <table id=\"no-bgc-table\" style=\"width: 100%;\">\n                    <tr>\n                        <td style=\"width: 61%; \">\n                            <table style=\"width: 100%;\">\n                                {% if doc.dauerrechnung == 1 %}\n                                    <tr style=\"border-bottom: none !important;\">\n                                        <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Dauerrechnung g\u00fcltig bis:</td>\n                                        <td style=\"padding: 0px !important; padding-left: 5px !important; padding-right: 5px !important; font-weight: normal !important; text-align: left;\">{{ doc.gultig_bis or \"-\"}}</td>\n                                    </tr>\n                                {% endif %}\n                                {% if doc.is_return == 1 %}\n                                    <tr style=\"border-bottom: none !important;\">\n                                        <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Gutschrift zu Rechnung:</td>\n                                        <td style=\"padding: 0px !important; padding-left: 5px !important; font-weight: normal !important; text-align: left;\">{{ doc.return_against }}</td>\n                                    </tr>\n                                {% endif %}\n                                <tr style=\"border-bottom: none !important;\">\n                                    <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \" >\n                                        {% if doc.is_return == 1 %}\n                                            Gutschrift-Nr:\n                                        {% else %}\n                                            Rechnungs-Nr:\n                                        {% endif %}\n                                    </td>\n                                    <td style=\"padding: 0px !important; padding-left: 5px !important; font-weight: normal !important; text-align: left;\">{{ doc.name }}</td>\n                                </tr>\n                                {% if so_number %}\n                                    <tr style=\"border-bottom: none !important;\">\n                                        <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Auftrags-Nr:</td>\n                                        <td style=\"padding: 0px !important; padding-left: 5px !important; padding-right: 5px !important; font-weight: normal !important; text-align: left;\">{{ so_number }}</td>\n                                    </tr>\n                                {% endif %}\n                                <tr style=\"border-bottom: none !important;\">\n                                    <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Kunden-Nr:</td>\n                                    <td style=\"padding: 0px !important; padding-left: 5px !important; font-weight: normal !important; text-align: left;\">{{ customer.navision_nr or \"-\" }}</td>\n                                </tr>\n                                <tr style=\"border-bottom: none !important;\">\n                                    <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important;\">Projekt-Nr:</td>\n                                    <td style=\"padding: 0px !important; padding-left: 5px !important; font-weight: normal !important; text-align: left;\">{{ doc.project or '-' }}</td>\n                                </tr>\n                                {% if project %}\n                                    <tr style=\"border-bottom: none !important;\">\n                                        <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Projekt:</td>\n                                        <td style=\"padding: 0px !important; padding-left: 5px !important; padding-right: 5px !important; font-weight: normal !important; text-align: left;\">{{ project.project_name }}</td>\n                                    </tr>\n                                {% endif %}\n                                {% if kundenreferenz %}\n                                    <tr style=\"border-bottom: none !important;\">\n                                        <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Ihre Bestellnummer:</td>\n                                        <td style=\"padding: 0px !important; padding-left: 5px !important; font-weight: normal !important; text-align: left;\">{{ kundenreferenz }}</td>\n                                    </tr>\n                                {% endif %}\n                                {% if so_kunde_ref %}\n                                    <tr style=\"border-bottom: none !important;\">\n                                        <td style=\"width: 140px !important; padding: 0px !important; font-weight: normal !important; \">Ihre Referenz:</td>\n                                        <td style=\"padding: 0px !important; padding-left: 5px !important; font-weight: normal !important; text-align: left; \">{{ so_kunde_ref }}</td>\n                                    </tr>\n                                {% endif %}\n                            </table>\n                        </td>\n                        <td style=\"width: 39%\">\n                        <!--lieferadresse -->\n                        {% if not doc.clear_address %}\n                            {% if doc.shipping_address_name %}\n                                {{ _(\"Lieferanschrift\") }}<br>\n                                    {% if shipping_address.address_line2 %}\n                                        {% if shipping_address.address_title %} {{  shipping_address.address_title }}<br>{% endif %}\n                                        {% if shipping_address.adresszusatz %} {{  shipping_address.adresszusatz }}<br>{% endif %}\n                                        {% if shipping_address.address_line1 %} {{  shipping_address.address_line1 }}{% endif %}\n                                        {% if shipping_address.hausnummer %} {{  shipping_address.hausnummer }}<br> {% else %} <br>  {% endif %}\n                                        {% if shipping_address.plz %} {{  shipping_address.plz }}{% endif %}\n                                        {% if shipping_address.city %} {{  shipping_address.city }}<br>{% endif %}\n                                    {% else %}\n                                        {% if doc.doctype == 'Quotation' %} {{ doc.party_name }}<br>\n                                        {% else %}{{ doc.customer }}<br>\n                                        {% endif %}\n                                        {% if shipping_address.adresszusatz %} {{  shipping_address.adresszusatz }}<br>{% endif %}\n                                        {% if shipping_address.address_line1 %} {{  shipping_address.address_line1 }}{% endif %}\n                                        {% if shipping_address.hausnummer %} {{  shipping_address.hausnummer }}<br> {% else %} <br> {% endif %}\n                                        {% if shipping_address.plz %} {{  shipping_address.plz }}{% endif %}\n                                        {% if shipping_address.city %} {{  shipping_address.city }}<br>{% endif %}\n                                    {% endif %}\n                            {% endif %}\n                        {% endif %}\n                        </td>\n                    </tr>\n                </table>\n                </td>\n            </tr>\n            <tr><!-- Items Table -->\n                <td style=\"width: 5%; text-align: center; padding-top: 15px !important;\">Pos.</td>\n                <td style=\"width: 45%; padding-top: 15px !important;\">Beschreibung</td>\n                <td style=\"width: 10%; padding-top: 15px !important; text-align: right;\">Menge</td>\n                <td style=\"width: 20%; padding-top: 15px !important; text-align: right;\">Preis</td>\n                <td style=\"width: 20%;padding-top: 15px !important; text-align: right;\">Betrag</td>\n            </tr>\n        </thead>\n        <tbody>\n        <!--Teilrechnung-->\n    {% if doc.items[0].sales_order %}\n        {% set teilrechnung_details = {'idx': 0, 'billing_portion': 0} %}\n        {% for teilrechnung in sales_order.billing_overview %}\n            {% if teilrechnung.sales_invoice == doc.name %}\n                {% if teilrechnung_details.update({'idx': teilrechnung.idx, 'billing_portion': teilrechnung.billing_portion}) %}{% endif %}\n            {% endif %}\n        {% endfor %}\n        {% if doc.billing_type == 'Teilrechnung' %}\n            {% if sales_order.billing_overview|len > 0 %}\n                <tr style=\"background-color: rgb(186, 210, 226) !important;\">\n                    <td style=\"border-right: 1px solid rgb(186, 210, 226) !important; text-align: center;\"><b>1</b></td>\n                    <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">{{ _(\"Abschlag\") }}</td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">1</td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                </tr>\n                    <tr>\n                    <td style=\"border-right: 1px solid rgb(186, 210, 226) !important; text-align: center;\"><b></b></td>\n                    <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">\n                    {{ teilrechnung_details.idx }}. Teilzahlung zu Projekt Nr. {{ sales_order.project }}<br>\n                    {{ \"{:,.1f}\".format(teilrechnung_details.billing_portion).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} % der Auftragssumme</td>\n                    <td colspan='3' style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">\n                </tr>\n                <!-- Total Zeilen -->\n                <tr class=\"blue-white\">\n                    <td style=\"background-color: white !important\" colspan =\"3\"></td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>{{_(\"Summe netto\") }}</b></td>\n                    <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.net_total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                </tr>\n                <tr class=\"blue-white\">\n                    <td style=\"background-color: white !important\" colspan =\"3\"></td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>zzgl. {{ doc.taxes[0].rate }}% MwSt.</b></td>\n                    <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.total_taxes_and_charges).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                </tr>\n                <tr class=\"blue-white\">\n                    <td style=\"background-color: white !important\" colspan =\"3\"></td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>Summe brutto</b></td>\n                    <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.grand_total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                </tr>\n            {% endif %}\n        {% else %}<!--Ende: Teilrechnung, Schlussrechnung beginnt-->\n        <!-- variable f\u00fcr positionsnummer -->\n        {% set position = {'nummer': 1} %}\n        <!-- variable f\u00fcr kalkulationssumme -->\n        {% set kalksum = {'total': 0} %}\n        <!-- Items Table -->\n        <!-- pro item -->\n            {% for so_item in sales_order.items %}\n            {% if not so_item.is_supplement %}\n                <!-- interne position -->\n                {% if so_item.interne_position %}\n                    <!-- add amount to kalkulationssumme -->\n                    {% if kalksum.update({'total': kalksum.total + so_item.amount}) %}{% endif %}\n                <!-- Kalkulationssumme -->\n                {% elif so_item.kalkulationssumme_interner_positionen %}\n                    <!-- add amount to kalkulationssumme -->\n                    {% if kalksum.update({'total': kalksum.total + so_item.amount}) %}{% endif %}\n                    <!-- print kalkulationssumme -->\n                    <tr style=\"background-color: rgb(186, 210, 226) !important;\">\n                        <td style=\"border-right: 1px solid rgb(186, 210, 226) !important; text-align: center;\"><b>{{ position.nummer }}</b></td>\n                        <!-- increment positionsnummer -->\n                        {% if position.update({'nummer': position.nummer + 1}) %}{% endif %}\n                        <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">{{ so_item.item_name }}</td>\n                        <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">1</td>\n                        <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ cur_icon }} {{ \"{:,.2f}\".format(kalksum.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                        <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ cur_icon }} {{ \"{:,.2f}\".format(kalksum.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                    </tr>\n                    {% for line in so_item.description.split(\"</div>\") %}\n                        <tr style=\"background-color: transparent !important;\">\n                            <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                            <td colspan=\"3\" style=\"border-right: 1px solid rgb(186, 210, 226) !important;font-size: 8pt;\">{{ line + '</div>' }}</td>\n                            <td></td>\n                        </tr>\n                    {% endfor %}\n                    <!-- reset kalkulationssumme -->\n                    {% if kalksum.update({'total': 0}) %}{% endif %}\n                <!-- anderes -->\n                {% else %}\n                    <!-- Versandkosten werden als Totalposition behandelt -->\n                    {% if so_item.item_group != 'Verpackung / Versand' %}\n                        <tr style=\"background-color: rgb(186, 210, 226) !important;\">\n                            <td style=\"border-right: 1px solid rgb(186, 210, 226) !important; text-align: center;\"><b>{{ position.nummer }}</b></td>\n                            <!-- increment positionsnummer -->\n                            {% if position.update({'nummer': position.nummer + 1}) %}{% endif %}\n                            <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">{% if so_item.alternative_position %}Optional:<br>{% endif %}{{ so_item.item_name }}</td>\n                            <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{% if not so_item.textposition %}{{ so_item.qty }}{% endif %}</td>\n                            {% if so_item.discount_percentage and not so_item.textposition %}\n                                {% if not so_item.alternative_position %}\n                                <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">\n                                    {% if so_item.rate_with_margin %}\n                                        {{ cur_icon }} {{ \"{:,.2f}\".format(so_item.rate_with_margin).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}<br>\n                                    {% else %}\n                                        {{ cur_icon }} {{ \"{:,.2f}\".format(so_item.price_list_rate).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}<br>\n                                    {% endif %}\n                                    -{{ \"{:,.2f}\".format(so_item.discount_percentage).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}%<br>\n                                    {{ cur_icon }} {{ \"{:,.2f}\".format(so_item.rate).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}\n                                </td>\n                                <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(so_item.amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                                {% else %}\n                                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ cur_icon }} {{ \"{:,.2f}\".format(so_item.preis_alternative_position).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                                {% endif %}\n                            {% else %}\n                                {% if not so_item.textposition %}\n                                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">\n                                        {{ cur_icon }} {{ \"{:,.2f}\".format(so_item.rate).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} \n                                    </td>\n                                    <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(so_item.amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                                {% else %}\n                                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                                {% endif %}\n                            {% endif %}\n                        </tr>\n                        {% for line in so_item.description.split(\"</div>\") %}\n                            <tr style=\"background-color: transparent !important;\">\n                                <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                                <td colspan=\"3\" style=\"border-right: 1px solid rgb(186, 210, 226) !important;font-size: 8pt;\">{{ line + '</div>' }}</td>\n                                <td></td>\n                            </tr>\n                        {% endfor %}\n                    {% endif %}\n                {% endif %}\n            <!-- Total Zeilen -->\n                {% if so_item.item_group == 'Verpackung / Versand' %}\n                    <tr class=\"blue-white\">\n                        <td colspan=\"4\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ so_item.item_name }}</td>\n                        <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(so_item.amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                    </tr>\n                {% endif %}\n            {% endif %}<!--Ende: if not so_item.is_supplement / Nachtragsposition-->\n            {% endfor %}<!--Ende: loop durch so items-->\n            <!--Teilrechnungs\u00fcbersicht in SO-->\n            <!--insert Abschlag -->\n            {% for teilrechnung in sales_order.billing_overview %}\n                {% if teilrechnung.sales_invoice != doc.name %}\n                    {% set tr_sales_invoice = frappe.get_doc(\"Sales Invoice\", teilrechnung.sales_invoice) %}\n                    <!--Abschlagsposition-->\n                    <tr style=\"background-color: rgb(186, 210, 226) !important;\">\n                        <td style=\"text-align: center;\"><b>{{ position.nummer }}</b></td>\n                        <td colspan = '4' style=\"font-size: 7.5pt;\">{{ _(\"Folgende Abschlagsrechnungen wurden Ihnen bereits zugesandt.<br>Zahlungseing\u00e4nge sind aufgef\u00fchrt soweit bereits gebucht.\") }}</td>\n                    </tr>\n                    <tr><!--Anzahlungen (Position.1, Position.2 etc)-->\n                        <td style=\"text-align: center; border-right: 1px solid rgb(186, 210, 226) !important;\"><i>{{ position.nummer }}.{{ teilrechnung.idx }}</i></td>\n                        <td><i>{{ _(\"Abschlag\") }} ({{ \"{:,.0f}\".format(tr_sales_invoice.taxes[0].rate) }} % MwSt.)</i></td>\n                        <td style=\"text-align: right;\"><i></i></td>\n                        <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><i></i></td>\n                        <td style=\"text-align: right; \"><i></i></td>\n                    </tr>\n                    <tr style=\"font-size: 7.5pt;\">\n                        <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                        <td colspan=\"3\" style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">{{ _(\"Abschlag\") }} {{ teilrechnung.idx }}: \n                        {% if teilrechnung.invoice_rhapsody %}\n                            {{ _(\"RG-Nr. Rhapsody\") }} {{ teilrechnung.invoice_rhapsody}}\n                        {% else %}\n                            {{ _(\"Rechnung-Nr.\") }} {{ tr_sales_invoice.name }}\n                        {% endif %}\n                        {{ _(\"vom\") }} {{ tr_sales_invoice.get_formatted('posting_date') }}</td>\n                        <td></td>\n                    </tr>\n                    <tr>\n                        <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                        <td colspan=\"3\" style=\" padding: 0px !important;\"> <!--Auflistung n+ Abschl\u00e4ge-->\n                            <table style=\"width: 100%; font-size: 7.5pt;\">\n                                <tr>\n                                    <td style=\"width: 30%;\">\n                                    - {{ _(\"Nettobetrag\") }}:<br>\n                                    - {{ _(\"Mehrwertsteuer\") }}:<br>\n                                    - {{ _(\"Bruttobetrag\") }}:<br>\n                                    - {{ _(\"Zahlungseingang\") }}:\n                                    </td>\n                                    <td style=\"text-align: right;\">\n                                    {{ cur_icon }} {{ \"{:,.2f}\".format(tr_sales_invoice.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}<br>\n                                    {{ cur_icon }} {{ \"{:,.2f}\".format(tr_sales_invoice.total_taxes_and_charges).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}<br>\n                                    {{ cur_icon }} {{ \"{:,.2f}\".format(tr_sales_invoice.grand_total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}<br>\n                                    {% if (tr_sales_invoice.grand_total - tr_sales_invoice.outstanding_amount) > 0 %}\n                                    {{ cur_icon }} {{ \"{:,.2f}\".format(tr_sales_invoice.grand_total - tr_sales_invoice.outstanding_amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}\n                                    {% else %} {{ \"-\" }}\n                                    {% endif %}\n                                    </td>\n                                    <td style=\"border-right: 1px solid rgb(186, 210, 226) !important; width: 50%;\">&nbsp;</td>\n                                </tr>\n                            </table>\n                        </td>\n                        <td></td>\n                    </tr>\n                {% endif %}\n            {% endfor %}\n            <!--Ende Abschlag -->\n            <!--Nachtragsposition-->\n            {% for item in doc.items %}\n                {% if item.is_supplement %}\n                {% if position.update({'nummer': position.nummer + 1}) %}{% endif %}\n                <tr>\n                    <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                    <td colspan= '3' style=\"border-right: 1px solid rgb(186, 210, 226) !important;\"><b>{{ _(\"Nachtrag/Zus\u00e4tzlicher Aufwand\") }}</b></td>\n                    <td></td>\n                </tr>\n                <tr style=\"background-color: rgb(186, 210, 226) !important;\">\n                    <td style=\"text-align: center; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>{{ position.nummer }}</b></td>\n                    <td>{{ item.item_name }}</td>\n                    <td style=\"text-align: right;\">{{ item.qty }}</td>\n                    <td style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">{{ cur_icon }} {{ \"{:,.2f}\".format(item.rate).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                    <td style=\"text-align: right; \">{{ cur_icon }} {{ \"{:,.2f}\".format(item.amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                </tr>\n                {% for line in item.description.split(\"</div>\") %}\n                    <tr style=\"background-color: transparent !important;\">\n                        <td style=\"border-right: 1px solid rgb(186, 210, 226) !important;\"></td>\n                        <td colspan=\"3\" style=\"border-right: 1px solid rgb(186, 210, 226) !important;\">{{ line + '</div>' }}</td>\n                        <td></td>\n                    </tr>\n                {% endfor %}\n                {% endif %}\n            {% endfor %}\n            <!--Ende Nachtragsposition-->\n            <tr class=\"blue-white\">\n                <td colspan=\"2\" style=\"width: 50%; background-color: white !important;\"></td>\n                <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important; width: 30%;\"><b>\n                {% if doc.discount_amount %}{{ _(\"Zwischensumme\") }}{% else %}{{_(\"Summe netto\") }}{% endif %}</b></td>\n                <td style=\"text-align: right; width: 20%;\">\n                {{ cur_icon }} {{ \"{:,.2f}\".format(doc.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n            </tr>\n            {% if doc.discount_amount %}\n            <tr class=\"blue-white\">\n                <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>{{ _(\"Rabatt\") }}</b></td>\n                <td style=\"text-align: right; \">{% if doc.additional_discount_percentage %}(-{{ doc.get_formatted('additional_discount_percentage') }} %){% endif %} {{ cur_icon }} {{ \"{:,.2f}\".format(doc.discount_amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} </td>\n            </tr>\n            <tr class=\"blue-white\">\n                <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>{{ _(\"Summe netto\") }}</b></td>\n                <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.net_total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n            </tr>\n            {% endif %}\n            <tr class=\"blue-white\">\n                <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>\n                zzgl. {{ doc.taxes[0].rate }}% MwSt.</b></td>\n                <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.total_taxes_and_charges).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n            </tr>\n            <tr class=\"blue-white\">\n                <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>Summe inkl. MwSt.</b></td>\n                <td style=\"text-align: right;\">{{ cur_icon }} {{ \"{:,.2f}\".format(doc.grand_total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n            </tr>\n            {% for teilrechnung in sales_order.billing_overview %}\n                {% if teilrechnung.sales_invoice != doc.name %}\n                    {% set tr_sales_invoice = frappe.get_doc(\"Sales Invoice\", teilrechnung.sales_invoice) %}\n                    <tr class=\"blue-white\">\n                        <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                        <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\"><b>\n                        abzgl. bereits gezahlte Abschl\u00e4ge netto</b></td>\n                        <td style=\"text-align: right;\">{{ cur_icon }} -{{ \"{:,.2f}\".format(tr_sales_invoice.total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                    </tr>\n                    <tr class=\"blue-white\">\n                        <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                        <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important; \"><b>\n                        abzgl. bereits gezahlte Abschl\u00e4ge {{ \"{:,.0f}\".format(tr_sales_invoice.taxes[0].rate) }} % MwSt.</b></td>\n                        <td style=\"text-align: right;\">{{ cur_icon }} -{{ \"{:,.2f}\".format(tr_sales_invoice.total_taxes_and_charges).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</td>\n                    </tr>\n                {% endif %}\n            {% endfor %}\n            <tr class=\"blue-white\">\n                <td colspan=\"2\" style=\"width: 50% ; background-color: white !important;\"></td>\n                <td colspan=\"2\" style=\"text-align: right; border-right: 1px solid rgb(186, 210, 226) !important;\">\n                <b>Summe Brutto</b></td>\n                <td style=\"text-align: right;\"><b>{{ cur_icon }} {{ \"{:,.2f}\".format(doc.outstanding_amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }}</b></td>\n            </tr>\n        {% endif %}<!--end schlussrechnung-->\n    {% else %}\n        <tr style=\"background-color: red !important;\">\n            <td colspan = '5' style=\"font-size: 7.5pt;\">Bitte befolgen Sie den korrekten Prozess zur Erstellung einer Schlussrechnung! (Erstellung Rechnung aus Auftragsbest\u00e4tigung)</td>\n        </tr>\n    {% endif %}\n        </tbody>\n    </table>\n</div>\n\n\n<div style=\"padding-left: 55px; page-break-inside: avoid;\">\n<!--Zahlungsbedingungen, auch ohne Template abdrucken-->\n{% if doc.doctype == 'Sales Invoice' %}\n        {% if doc.leistungsdatum %}<br>{{ doc.get_formatted('leistungsdatum') }}<br>{% else %}\n        <br>{{ _(\"Soweit nicht anders angegeben gilt, Leistungsdatum = Rechnungsdatum.\") }}<br>\n        {% endif %}\n    {% if doc.payment_schedule|len > 0 %}<br>\n        <b>Zahlungsbedingungen:</b><br>\n        {{ _(\"Bitte \u00fcberweisen Sie den Rechnungsbetrag fristgerecht auf das unten angegebene Konto.\") }}<br>\n            <!--falls SO-Referenz, schauen ob dort Skonto, sonst payment terms SI-->\n            {% if (doc.billing_type == 'Teilrechnung') and (doc.items[0].sales_order) %}\n                {% set so = frappe.get_doc(\"Sales Order\", doc.items[0].sales_order) %}\n                {% set so_payment_terms = frappe.get_doc(\"Payment Terms Template\", so.payment_terms_template) %}\n                    {% if so_payment_terms.skonto_days %}\n                        <!--date: posting_date + skontodays-->\n                        {{_(\"Bei Zahlung bis zum\") }} {{ frappe.utils.get_datetime(frappe.utils.add_days(doc.posting_date, so_payment_terms.skonto_days)).strftime('%d.%m.%Y') }} {{ _(\"gew\u00e4hren wir\") }} {{ so_payment_terms.skonto_percent }} % Skonto \n                        ({{ \"{:,.2f}\".format(doc.grand_total*so_payment_terms.skonto_percent/100).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} {{ cur_icon }} inkl. {{ \"{:,.2f}\".format(doc.grand_total*so_payment_terms.skonto_percent/100*doc.taxes[0].rate/100).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} {{ cur_icon }} USt.).<br>\n                        <!--Gesamttotal abzgl Skonto, date: doc.posting_date + payment_terms.skonto_days-->\n                        {{ \"{:,.2f}\".format((doc.grand_total - (doc.grand_total*so_payment_terms.skonto_percent/100))).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} {{ cur_icon }} Zahlbar ohne Abzug bis zum \n                        {{ frappe.utils.get_datetime(frappe.utils.add_days(doc.posting_date, so_payment_terms.skonto_days)).strftime('%d.%m.%Y') }}<br>\n                    {% endif %}\n            {% else %}\n                {% if doc.payment_terms_template %}\n                    {% set total_control = {'total': 0, 'correction': 0, 'len': doc.payment_schedule|len } %}\n                    {% for ps in doc.payment_schedule %}\n                        {% set payment_amount_total = ps.payment_amount %}\n                        {% set total_correction = payment_amount_total - payment_amount_total|round(2) %}\n                        {% if total_control.update({'total': total_control.total + ps.payment_amount|round(2)}) %}{% endif %}\n                        {% if total_control.update({'correction': total_control.correction + total_correction}) %}{% endif %}\n                        {% if total_control.len == loop.index %}\n                            {% if total_control.total != doc.grand_total %}\n                                {% set payment_amount_total = payment_amount_total + total_control.correction|round(2) %}\n                            {% endif %}\n                        {% endif %}\n                        {{ ps.invoice_portion }}% ({{ cur_icon }} {{ \"{:,.2f}\".format(payment_amount_total).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} ) {{ ps.description or \"\" }}<br>\n                        \n                    {% endfor %}\n                {% endif %}\n            {% endif %}\n    {% endif %}\n    <!--Immer: Gesamttotal, duedate-->\n     <!-- {{ \"{:,.2f}\".format(doc.outstanding_amount).replace(\",\", \"'\").replace(\".\", \",\").replace(\"'\", \".\") }} {{ cur_icon }} Zahlbar ohne Abzug bis zum {{ doc.get_formatted('due_date') }}-->\n{% endif %}<br><br>\n{% if doc.terms %}<br>{{ doc.terms }}{% endif %}\n</div>\n<div style=\"padding-left: 55px; page-break-inside: avoid;\">\n    <br>Mit freundlichen Gr\u00fc\u00dfen\n    <p><br></p>\n    <b>energielenker solutions GmbH</b>\n    <p><br></p>\n    ppa. Markus Grosse Gorgemann<br><br>\n    <i>(dieses Schreiben wurde maschinell erstellt und ist auch ohne Unterschrift g\u00fcltig)</i>\n</div>\n\n<!-- Footer -->\n<div id=\"footer-html\" class=\"visible-pdf\">\n    <p style=\"font-size: 8pt; text-align: center;\">\n        energielenker solutions GmbH <b>Gesch\u00e4ftsf\u00fchrer</b> Tobias Dollberg, Christian Fuchte, <b>WEEE-Nr: 51140965</b> <br>\n        <b>AGB</b> https://energielenker-solutions.de/agb/ <b>Amtsgericht M\u00fcnster</b> HRB 16647 <b>Sitz</b> M\u00fcnster<br>\n        <b>Steuer-Nr.</b> 327/5780/8051 <b>USt-Id-Nr.</b> DE300828709 <b>Bankverbindung</b> Sparkasse Emsdetten Ochtrup<br>\n        <b>IBAN</b> DE78 4015 3768 0000 2103 95  <b>BIC</b> WELADED1EMS\n    </p>\n    <p style=\"font-size: 8pt !important; text-align: center; \">{{ _(\"Page\") }} <span class=\"page\"></span> {{ _(\"of\") }} <span class=\"topage\"></span></p>\n</div>",
 "idx": 0,
 "line_breaks": 0,
 "modified": "2023-10-04 10:22:13.049706",
 "modified_by": "Administrator",
 "module": "energielenker",
 "name": "Teil- & Schlussrechnung (EL)",
 "owner": "Administrator",
 "print_format_builder": 1,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}